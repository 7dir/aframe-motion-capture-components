!function(t){function e(n){if(r[n])return r[n].exports;var i=r[n]={exports:{},id:n,loaded:!1};return t[n].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var r={};return e.m=t,e.c=r,e.p="",e(0)}([function(t,e,r){if("undefined"==typeof AFRAME)throw new Error("Component attempted to register before AFRAME was available.");r(2),r(1),r(3)},function(t,e){AFRAME.registerComponent("motion-capture-player",{schema:{enabled:{default:!0},recorderEl:{type:"selector"}},init:function(){this.onStrokeStarted=this.onStrokeStarted.bind(this),this.onStrokeEnded=this.onStrokeEnded.bind(this)},update:function(t){var e=this.data.recorderEl,r=t.recorderEl;r&&r!==e&&(t.recorderEl.removeEventListener("strokestarted",this.onStrokeStarted),t.recorderEl.removeEventListener("strokeended",this.onStrokeEnded)),r!==e&&(e.addEventListener("strokestarted",this.onStrokeStarted),e.addEventListener("strokeended",this.onStrokeEnded))},onStrokeStarted:function(t){this.playingStroke=null,this.currentTime=void 0,this.currentPoseIndex=void 0},onStrokeEnded:function(t){this.playingStroke=t.detail.stroke,this.currentTime=this.playingStroke[0].timestamp,this.currentPoseIndex=0},applyPose:function(t){var e=new THREE.Euler;return function(t){var r=this.el;e.setFromQuaternion(t.rotation),r.setAttribute("position",t.position),r.setAttribute("rotation",e)}}(),tick:function(){new THREE.Vector3,new THREE.Quaternion,new THREE.Vector3;return function(t,e){var r=this.playingStroke;r&&(this.currentTime?this.currentTime+=e:this.currentTime=r[0].timestamp,this.currentTime>=this.playingStroke[this.currentPoseIndex].timestamp&&(this.currentPoseIndex+=1,this.currentPoseIndex===r.length&&(this.currentPoseIndex=0,this.currentTime=r[0].timestamp)),this.applyPose(r[this.currentPoseIndex]))}}()})},function(t,e){AFRAME.registerComponent("motion-capture-recorder",{schema:{enabled:{default:!0},hand:{default:"right"}},init:function(){var t=this.el;this.onTriggerChanged=this.onTriggerChanged.bind(this),this.drawing=!1,t.addEventListener("buttonchanged",this.onTriggerChanged.bind(this))},init:function(t,e){this.idx=0,this.geometry=new THREE.BufferGeometry,this.vertices=new Float32Array(3*this.options.maxPoints*3),this.normals=new Float32Array(3*this.options.maxPoints*3),this.uvs=new Float32Array(2*this.options.maxPoints*2),this.geometry.setDrawRange(0,0),this.geometry.addAttribute("position",new THREE.BufferAttribute(this.vertices,3).setDynamic(!0)),this.geometry.addAttribute("uv",new THREE.BufferAttribute(this.uvs,2).setDynamic(!0)),this.geometry.addAttribute("normal",new THREE.BufferAttribute(this.normals,3).setDynamic(!0));var r=new THREE.Mesh(this.geometry,this.getMaterial());r.drawMode=THREE.TriangleStripDrawMode,r.frustumCulled=!1,r.vertices=this.vertices,this.object3D.add(r)},getMaterial:function(){var t=this.materialOptions.map,e=this.materialOptions.type,r={},n={};t&&(n={map:t,transparent:!0,alphaTest:.5}),r="shaded"===e?{color:this.data.color,roughness:.75,metalness:.25,side:THREE.DoubleSide}:{color:this.data.color,side:THREE.DoubleSide};var i=Object.assign(r,n,this.materialOptions);return delete i.type,"shaded"===e?new THREE.MeshStandardMaterial(i):new THREE.MeshBasicMaterial(i)},onTriggerChanged:function(t){var e;if(this.data.enabled&&1===t.detail.id)return e=t.detail.state.value,e<=.1?(this.currentStroke&&this.el.emit("strokeended",{stroke:this.currentStroke}),void(this.currentStroke=null)):void(this.currentStroke||(this.startNewStroke(),this.el.emit("strokestarted")))},update:function(){var t=this.el,e=this.data;t.setAttribute("vive-controls",{hand:e.hand}),t.setAttribute("oculus-touch-controls",{hand:e.hand})},tick:function(){var t=new THREE.Vector3,e=new THREE.Quaternion,r=new THREE.Vector3;return function(n,i){var o,a;this.currentStroke&&this.data.enabled&&(this.el.object3D.matrixWorld.decompose(t,e,r),o={position:t.clone(),rotation:e.clone(),timestamp:n},this.currentStroke.push(o),a=getPointerPosition(o.position,o.position),this.el.compoents.stroke.drawPoint(o.position,o.rotation,o.timestamp,a))}}(),getPointerPosition:function(){var t=new THREE.Vector3,e=new THREE.Vector3(0,.7,1);return function(r,n){var i=e.clone().applyQuaternion(n).normalize().multiplyScalar(-.03);return t.copy(r).add(i),t}}(),startNewStroke:function(){this.currentStroke=this.system.addNewStroke(),this.el.emit("stroke-started",{entity:this.el,stroke:this.currentStroke})}})},function(t,e){AFRAME.registerSystem("motion-capture-recorder",{init:function(){this.strokes=[]},undo:function(){var t=this.strokes.pop();if(t){var e=t.entity;e.emit("stroke-removed",{entity:e}),e.parentNode.removeChild(e)}},clear:function(){for(var t=0;t<this.strokes.length;t++){var e=this.strokes[t].entity;e.parentNode.removeChild(e)}this.strokes=[]},generateRandomStrokes:function(t){function e(){return 2*Math.random()-1}for(var r=0;r<t;r++)for(var n=parseInt(500*Math.random()),i=this.addNewStroke(),o=new THREE.Vector3(e(),e(),e()),a=new THREE.Vector3,s=new THREE.Quaternion,d=.2,h=0;h<n;h++){a.set(e(),e(),e()),a.multiplyScalar(e()/20),s.setFromUnitVectors(o.clone().normalize(),a.clone().normalize()),o=o.add(a);var u=0,c=this.getPointerPosition(o,s);i.addPoint(o,s,c,d,u)}},addNewStroke:function(){var t=[];return this.strokes.push(t),t},getJSON:function(){var t={version:VERSION,strokes:[],author:""};for(i=0;i<this.strokes.length;i++)t.strokes.push(this.strokes[i].getJSON(this));return t},getBinary:function(){var t=[],e="apainter",r=this.strokes=[],n=e.length,i=new BinaryManager(new ArrayBuffer(n));i.writeString(e),i.writeUint16(VERSION),i.writeUint32(this.strokes.length),t.push(i.getDataView());for(var o=0;o<r.length;o++)t.push(this.getStrokeBinary(r[o]));return t},getStrokeBinary:function(t){var e=4+36*t.length,r=new BinaryManager(new ArrayBuffer(e));r.writeUint32(t.length);for(var n=0;n<t.length;n++){var i=t[n];r.writeFloat32Array(i.position.toArray()),r.writeFloat32Array(i.orientation.toArray()),r.writeUint32(i.timestamp)}return r.getDataView()},getPointerPosition:function(){var t=new THREE.Vector3,e=new THREE.Vector3(0,.7,1);return function(r,n){var i=e.clone().applyQuaternion(n).normalize().multiplyScalar(-.03);return t.copy(r).add(i),t}}(),loadJSON:function(t){t.version!==VERSION&&console.error("Invalid version: ",version,"(Expected: "+VERSION+")");for(var e=0;e<t.strokes.length;e++)for(var r=t.strokes[e],n=this.addNewStroke(),i=0;i<r.points.length;i++){var o=r.points[i],a=(new THREE.Vector3).fromArray(o.position),s=((new THREE.Quaternion).fromArray(o.orientation),o.timestamp);n.push({position:a,rotation:rotation,timestamp:s})}},loadBinary:function(t){var e=new BinaryManager(t),r=e.readString();if("apainter"!==r)return void console.error("Invalid `magic` header");var n=e.readUint16();n!==VERSION&&console.error("Invalid version: ",n,"(Expected: "+VERSION+")");for(var i=e.readUint32(),o=0;o<i;o++)for(var a=e.readUint32(),s=this.addNewStroke(),d=0;d<a;d++){var h=e.readVector3();e.readQuaternion(),e.readUint32();s.push({position:h,rotation:rotation,timestamp:time})}},loadFromUrl:function(t,e){var r=new THREE.XHRLoader(this.manager);r.crossOrigin="anonymous",e===!0&&r.setResponseType("arraybuffer");var n=this;r.load(t,function(t){e===!0?n.loadBinary(t):n.loadJSON(JSON.parse(t))})}})}]);